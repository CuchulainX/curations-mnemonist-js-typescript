<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>
<style>*{box-sizing:border-box}body{font-family:system-ui,sans-serif;margin:0}</style>
<meta name='generator' content='mdx-deck'>
<title data-head="true">FOSDEM 2019 - Developing data structures for JavaScript</title><link href="https://fonts.googleapis.com/css?family=Muli:900" rel="stylesheet" data-head="true"/><style data-styled-components="jDCqyd kmKUJZ gKaMTo zIEGn CQhxV fxbReE byfFmt cVxceg kPOGYN gsyCmg RNNXF kztYHz eIIwaK hQYcg iLvMQI gmKbQu ccSRck bQMXUX ihLfci hmXDXQ gaOIFD hhoFSc UmMUS hJnpUz fQmsFW fJODMz CAuLq hLseSp">
/* sc-component-id: sc-bZQynM */
.sc-bZQynM {} .kmKUJZ{overflow-x:hidden;width:100%;height:100%;} @media print{.kmKUJZ{height:auto;overflow-x:visible;}}
/* sc-component-id: sc-gzVnrw */
.sc-gzVnrw {} .gKaMTo{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;height:100%;-webkit-transition-property:-webkit-transform;-webkit-transition-property:transform;transition-property:transform;-webkit-transition-timing-function:ease-out;transition-timing-function:ease-out;-webkit-transition-duration:.3s;transition-duration:.3s;-webkit-transform:translate3d(0%,0,0);-ms-transform:translate3d(0%,0,0);transform:translate3d(0%,0,0);} @media print{.gKaMTo{height:auto;display:block;}}
/* sc-component-id: sc-htoDjs */
.sc-htoDjs {} .zIEGn{-webkit-flex:none;-ms-flex:none;flex:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;overflow:hidden;width:100%;height:100%;padding-left:32px;padding-right:32px;} @media print{.zIEGn{width:100vw;height:100vh;page-break-after:always;page-break-inside:avoid;-webkit-print-color-adjust:exact;}} @media screen and (min-width:40em){.zIEGn{padding-left:64px;padding-right:64px;}} @media screen and (min-width:52em){.zIEGn{padding-left:128px;padding-right:128px;}}
/* sc-component-id: sc-dnqmqq */
.sc-dnqmqq {} .jDCqyd{font-family:Bitter,sans-serif;text-align:left;font-size:16px;width:100vw;height:100vh;color:#363636;background-color:F5F5F5;} @media print{.jDCqyd{font-size:24px;height:auto;}} @media screen and (min-width:64em){.jDCqyd{font-size:32px;}} .jDCqyd .Slide > div{min-width:80vw;min-height:60vh;} .jDCqyd strong,.jDCqyd .affix{color:#C65146;} .jDCqyd blockquote > p{font-style:italic;} .jDCqyd pre{padding:0.5em !important;line-height:normal !important;} .jDCqyd pre > code{font-size:0.8em;line-height:normal !important;} .jDCqyd .very-small{font-size:0.5em;}
/* sc-component-id: sc-jzJRlG */
.sc-jzJRlG {} .hLseSp{line-height:1.25;font-size:3em;margin-bottom:16px;margin-top:16px;color:heading;font-weight:900;font-family:Muli,sans-serif;}
/* sc-component-id: sc-cSHVUG */
.sc-cSHVUG {}
/* sc-component-id: sc-kAzzGY */
.sc-kAzzGY {} .cVxceg{line-height:1.25;font-size:2em;margin-bottom:16px;margin-top:16px;color:heading;font-weight:900;font-family:Muli,sans-serif;}
/* sc-component-id: sc-chPdSV */
.sc-chPdSV {}
/* sc-component-id: sc-kgoBCf */
.sc-kgoBCf {} .hQYcg{line-height:1.25;font-size:1.5em;margin-bottom:16px;margin-top:16px;color:heading;font-weight:900;font-family:Muli,sans-serif;}
/* sc-component-id: sc-kGXeez */
.sc-kGXeez {}
/* sc-component-id: sc-kEYyzF */
.sc-kEYyzF {} .RNNXF{color:#C65146;}
/* sc-component-id: sc-kkGfuU */
.sc-kkGfuU {} .kPOGYN{font-size:1.5em;}
/* sc-component-id: sc-iAyFgw */
.sc-iAyFgw {} .iLvMQI{text-align:left;font-size:1.5em;text-align:left;}
/* sc-component-id: sc-hSdWYo */
.sc-hSdWYo {} .fJODMz{text-align:left;font-size:1.5em;text-align:left;}
/* sc-component-id: sc-eHgmQL */
.sc-eHgmQL {}
/* sc-component-id: sc-cvbbAY */
.sc-cvbbAY {} .kztYHz{text-align:left;font-weight:bold;font-size:1.5em;margin-left:0px;margin-right:0px;padding-left:0px;padding-right:0px;color:quote;}
/* sc-component-id: sc-brqgnP */
.sc-brqgnP {} .gsyCmg{font-family:Menlo,monospace;color:#C65146;background-color:#f5f5f5;}
/* sc-component-id: sc-cMljjf */
.sc-cMljjf {} .hhoFSc{max-width:100%;height:auto;object-fit:cover;}
/* sc-component-id: sc-jAaTju */
.sc-jAaTju {} .UmMUS{overflow-x:auto;}
/* sc-component-id: sc-jDwBTQ */
.sc-jDwBTQ {} .hJnpUz{width:100%;border-collapse:separate;border-spacing:0;} .hJnpUz td,.hJnpUz th{text-align:left;padding-right:.5em;padding-top:.25em;padding-bottom:.25em;border-bottom:1px solid;vertical-align:top;}
/* sc-component-id: WideLayout__Root-sc-16prk5t-0 */
.WideLayout__Root-sc-16prk5t-0 {} .ihLfci{width:80%;}
/* sc-component-id: WideLayout__OtherRoot-sc-16prk5t-1 */
.WideLayout__OtherRoot-sc-16prk5t-1 {} .fQmsFW{width:80%;font-size:0.8em;}
/* sc-component-id: sc-gipzik */
.sc-gipzik {} .fxbReE{line-height:1.25;font-size:3em;margin-bottom:16px;margin-top:16px;color:heading;font-weight:900;font-family:Muli,sans-serif;}
/* sc-component-id: sc-csuQGl */
.sc-csuQGl {}
/* sc-component-id: sc-Rmtcm */
.sc-Rmtcm {} .bQMXUX{line-height:1.25;font-size:2em;margin-bottom:16px;margin-top:16px;color:heading;font-weight:900;font-family:Muli,sans-serif;}
/* sc-component-id: sc-bRBYWo */
.sc-bRBYWo {}
/* sc-component-id: sc-hzDkRC */
.sc-hzDkRC {} .gaOIFD{line-height:1.25;font-size:1.5em;margin-bottom:16px;margin-top:16px;color:heading;font-weight:900;font-family:Muli,sans-serif;}
/* sc-component-id: sc-jhAzac */
.sc-jhAzac {}</style>
</head>
<body>
<div id=root><div><div class="sc-dnqmqq jDCqyd" mode="NORMAL" step="0" width="100vw" height="100vh" color="text"><link href="https://fonts.googleapis.com/css?family=Bitter" rel="stylesheet"/><div class="sc-bZQynM kmKUJZ"><div class="sc-gzVnrw gKaMTo"><div class="sc-htoDjs zIEGn"><div><h1 class="sc-csuQGl CQhxV sc-gipzik fxbReE" style="text-decoration:underline" font-size="4" color="heading">Developing<br/>data structures<br/>for JavaScript</h1><small>JavaScript devroom, FOSDEM 2019, Brussels</small></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-chPdSV byfFmt sc-kAzzGY cVxceg" font-size="3" color="heading">Why and how to implement efficient data structures to use with node.js or in the browser?</h2></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-chPdSV byfFmt sc-kAzzGY cVxceg" font-size="3" color="heading">Who am I?</h2><p class="sc-kkGfuU kPOGYN" font-size="2"><em>Guillaume Plique</em></p><p class="sc-kkGfuU kPOGYN" font-size="2">alias <code class="sc-brqgnP gsyCmg" color="code">Yomguithereal</code> on both <a class="sc-kEYyzF RNNXF" href="https://github.com/Yomguithereal" color="link">Github</a> and <a class="sc-kEYyzF RNNXF" href="https://twitter.com/Yomguithereal" color="link">Twitter</a>.</p><p class="sc-kkGfuU kPOGYN" font-size="2">Research engineer working for Sciences Po&#x27;s <a class="sc-kEYyzF RNNXF" href="https://medialab.sciencespo.fr" color="link">médialab</a>.</p></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-chPdSV byfFmt sc-kAzzGY cVxceg" font-size="3" color="heading">What&#x27;s a data structure?</h2></div></div><div class="sc-htoDjs zIEGn"><div><blockquote class="sc-cvbbAY kztYHz" font-size="2" color="quote"><p class="sc-kkGfuU kPOGYN" font-size="2">«Web development is not real development and is henceforth easier.»</p></blockquote><div style="text-align:right"><small>Someone wrong on the Internet.</small></div></div></div><div class="sc-htoDjs zIEGn"><div><blockquote class="sc-cvbbAY kztYHz" font-size="2" color="quote"><p class="sc-kkGfuU kPOGYN" font-size="2">«Web development is trivial and web developers don&#x27;t need fancy data structures or any solid knowledge in algorithmics.»</p></blockquote><div style="text-align:right"><small>Someone also wrong (and pedant) on the Internet.</small></div></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-kGXeez eIIwaK sc-kgoBCf hQYcg" font-size="2" color="heading">Don&#x27;t we already have fully satisfying data structures in JavaScript?</h3><ul class="sc-iAyFgw iLvMQI" font-size="2"><li class="sc-eHgmQL gmKbQu"><code class="sc-brqgnP gsyCmg" color="code">Array</code> ➡ lists of things</li><li class="sc-eHgmQL gmKbQu"><code class="sc-brqgnP gsyCmg" color="code">Object</code> ➡ key-value associations</li><li class="sc-eHgmQL gmKbQu"><code class="sc-brqgnP gsyCmg" color="code">Map</code> and <code class="sc-brqgnP gsyCmg" color="code">Set</code> with ES6</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-bRBYWo ccSRck sc-Rmtcm bQMXUX" font-size="3" color="heading"><span class="affix">•</span> <!-- -->Why would we want other data structures in JavaScript?</h2></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-bRBYWo ccSRck sc-Rmtcm bQMXUX" font-size="3" color="heading"><span class="affix">•</span> <!-- -->Convenience and bookkeeping</h2></div></div><div class="sc-htoDjs zIEGn"><div class="WideLayout__Root-sc-16prk5t-0 ihLfci"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->A MultiSet</h3><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#808080">// How about changing this:</span>
<span class="token" style="color:#cc7832">const</span> counts <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#a9b7c6">{</span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">;</span>

<span class="token" style="color:#cc7832">for</span> <span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#cc7832">const</span> item <span class="token" style="color:#cc7832">in</span> something<span class="token" style="color:#a9b7c6">)</span> <span class="token" style="color:#a9b7c6">{</span>
  <span class="token" style="color:#cc7832">if</span> <span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">!</span><span class="token" style="color:#a9b7c6">(</span>item <span class="token" style="color:#cc7832">in</span> counts<span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">)</span>
    counts<span class="token" style="color:#a9b7c6">[</span>item<span class="token" style="color:#a9b7c6">]</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6897bb">0</span><span class="token" style="color:#a9b7c6">;</span>

  counts<span class="token" style="color:#a9b7c6">[</span>item<span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">++</span><span class="token" style="color:#a9b7c6">;</span>
<span class="token" style="color:#a9b7c6">}</span>
</code></pre><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#808080">// Into this:</span>
<span class="token" style="color:#cc7832">const</span> counts <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#cc7832">new</span> <span class="token,class-name">MultiSet</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>

<span class="token" style="color:#cc7832">for</span> <span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#cc7832">const</span> item <span class="token" style="color:#cc7832">in</span> something<span class="token" style="color:#a9b7c6">)</span>
  counts<span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#ffc66d">add</span><span class="token" style="color:#a9b7c6">(</span>item<span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>
</code></pre></div></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->Complex structures: a Graph</h3><p class="sc-kkGfuU kPOGYN" font-size="2">Sure, you can &quot;implement&quot; graphs using only <code class="sc-brqgnP gsyCmg" color="code">Array</code> and <code class="sc-brqgnP gsyCmg" color="code">Object</code>™.</p><p class="sc-kkGfuU kPOGYN" font-size="2">But:</p><ul class="sc-iAyFgw iLvMQI" font-size="2"><li class="sc-eHgmQL gmKbQu">Lots of bookkeeping (multi-way indexation)</li><li class="sc-eHgmQL gmKbQu">Wouldn&#x27;t it be nice to have a legible interface?</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><p class="sc-kkGfuU kPOGYN" font-size="2">Examples taken from the <a class="sc-kEYyzF RNNXF" href="https://graphology.github.io/" color="link">graphology</a> library:</p><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#cc7832">const</span> graph <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#cc7832">new</span> <span class="token,class-name">Graph</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>

<span class="token" style="color:#808080">// Finding specific neighbors</span>
<span class="token" style="color:#cc7832">const</span> neighbors <span class="token" style="color:#a9b7c6">=</span> graph<span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#ffc66d">outNeighbors</span><span class="token" style="color:#a9b7c6">(</span>node<span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>

<span class="token" style="color:#808080">// Iterating over a node&#x27;s edges</span>
graph<span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#ffc66d">forEachEdge</span><span class="token" style="color:#a9b7c6">(</span>node<span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#a9b7c6">(</span>edge<span class="token" style="color:#a9b7c6">,</span> attributes<span class="token" style="color:#a9b7c6">)</span> <span class="token" style="color:#a9b7c6">=&gt;</span> <span class="token" style="color:#a9b7c6">{</span>
  console<span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#ffc66d">log</span><span class="token" style="color:#a9b7c6">(</span>attributes<span class="token" style="color:#a9b7c6">.</span>weight<span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>
<span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-bRBYWo ccSRck sc-Rmtcm bQMXUX" font-size="3" color="heading"><span class="affix">•</span> <!-- -->Sometimes Arrays and Objects are not enough</h2></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->More than just tacky website candy</h3><ul class="sc-iAyFgw iLvMQI" font-size="2"><li class="sc-eHgmQL gmKbQu">We process data on the client nowadays.</li><li class="sc-eHgmQL gmKbQu">Node.js became a thing.</li><li class="sc-eHgmQL gmKbQu">Some algorithms cannot be efficiently implemented without custom data structures (Dijkstra or Inverted Index for full text search etc.).</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->The QuadTree</h3><img class="sc-cMljjf hhoFSc" src="./img/quad.svg" alt="Quad"/></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->The QuadTree</h3><img class="sc-cMljjf hhoFSc" src="./img/quadtree.svg" alt="QuadTree"/></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-bRBYWo ccSRck sc-Rmtcm bQMXUX" font-size="3" color="heading"><span class="affix">•</span> <!-- -->What are the challenges?</h2></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->Interpreted languages are far from the metal</h3></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->No control over memory layout</h3><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->No control over garbage collection</h3></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->JIT &amp; optimizing engines such as Gecko / V8</h3></div></div><div class="sc-htoDjs zIEGn"><div><p class="sc-kkGfuU kPOGYN" font-size="2">Benchmarking code accurately is <strong>not</strong> easy.</p></div></div><div class="sc-htoDjs zIEGn"><div><p class="sc-kkGfuU kPOGYN" font-size="2">It does not mean we cannot be <strong>clever</strong> about it.</p></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-bRBYWo ccSRck sc-Rmtcm bQMXUX" font-size="3" color="heading"><span class="affix">•</span> <!-- -->Implementation tips</h2></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->Time &amp; memory performance</h3></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->Minimizing lookups</h3><p class="sc-kkGfuU kPOGYN" font-size="2">&quot;Hashmap&quot; lookups are costly.</p><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#808080">// You made 2 lookups</span>
Graph<span class="token" style="color:#a9b7c6">.</span>prototype<span class="token" style="color:#a9b7c6">.</span><span class="token,function-variable" style="color:#ffc66d">getNodeAttribute</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#cc7832">function</span><span class="token" style="color:#a9b7c6">(</span>node<span class="token" style="color:#a9b7c6">,</span> data<span class="token" style="color:#a9b7c6">)</span> <span class="token" style="color:#a9b7c6">{</span>
  <span class="token" style="color:#cc7832">if</span> <span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#cc7832">this</span><span class="token" style="color:#a9b7c6">.</span>_nodes<span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#ffc66d">has</span><span class="token" style="color:#a9b7c6">(</span>node<span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">)</span>
    <span class="token" style="color:#cc7832">throw</span> <span class="token" style="color:#ffc66d">Error</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">...</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>

  <span class="token" style="color:#cc7832">const</span> data <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#cc7832">this</span><span class="token" style="color:#a9b7c6">.</span>_nodes<span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#cc7832">get</span><span class="token" style="color:#a9b7c6">(</span>node<span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>

  <span class="token" style="color:#cc7832">return</span> data<span class="token" style="color:#a9b7c6">[</span>name<span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">;</span>
<span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">;</span>
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#808080">// You made only one</span>
Graph<span class="token" style="color:#a9b7c6">.</span>prototype<span class="token" style="color:#a9b7c6">.</span><span class="token,function-variable" style="color:#ffc66d">getNodeAttribute</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#cc7832">function</span><span class="token" style="color:#a9b7c6">(</span>node<span class="token" style="color:#a9b7c6">,</span> data<span class="token" style="color:#a9b7c6">)</span> <span class="token" style="color:#a9b7c6">{</span>
  <span class="token" style="color:#cc7832">const</span> data <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#cc7832">this</span><span class="token" style="color:#a9b7c6">.</span>_nodes<span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#cc7832">get</span><span class="token" style="color:#a9b7c6">(</span>node<span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>

  <span class="token" style="color:#cc7832">if</span> <span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#cc7832">typeof</span> data <span class="token" style="color:#a9b7c6">===</span> <span class="token" style="color:#6a8759">&#x27;undefined&#x27;</span><span class="token" style="color:#a9b7c6">)</span>
    <span class="token" style="color:#cc7832">throw</span> <span class="token" style="color:#ffc66d">Error</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">...</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>

  <span class="token" style="color:#cc7832">return</span> data<span class="token" style="color:#a9b7c6">[</span>name<span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">;</span>
<span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">;</span>
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div class="WideLayout__Root-sc-16prk5t-0 ihLfci"><div><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"># Result, 100k items
--------------------
Two lookups: 31.275ms
One lookup:  15.762ms
</code></pre><p class="sc-kkGfuU kPOGYN" font-size="2">The engine is clever. But not <em>that</em> clever. <small class="very-small">(It improves frequently, though...)</small></p><p class="sc-kkGfuU kPOGYN" font-size="2">The «<em>let&#x27;s code badly, the engine will clean up my mess</em>» approach will not work.</p></div></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->Creating objects is costly</h3><ul class="sc-iAyFgw iLvMQI" font-size="2"><li class="sc-eHgmQL gmKbQu">Avoid allocating objects.</li><li class="sc-eHgmQL gmKbQu">Avoid /(?:re<!-- -->-<!-- -->)?creating/ regexes.</li><li class="sc-eHgmQL gmKbQu">Avoid nesting functions whenever possible.</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#808080">// BAD!</span>
<span class="token" style="color:#cc7832">const</span> <span class="token,function-variable" style="color:#ffc66d">test</span> <span class="token" style="color:#a9b7c6">=</span> x <span class="token" style="color:#a9b7c6">=&gt;</span> <span class="token" style="background:#364135">/regex/</span><span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#ffc66d">test</span><span class="token" style="color:#a9b7c6">(</span>x<span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>

<span class="token" style="color:#808080">// GOOD!</span>
<span class="token" style="color:#cc7832">const</span> <span class="token" style="color:#9876aa">REGEX</span> <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="background:#364135">/regex/</span><span class="token" style="color:#a9b7c6">;</span>
<span class="token" style="color:#cc7832">const</span> <span class="token,function-variable" style="color:#ffc66d">test</span> <span class="token" style="color:#a9b7c6">=</span> x <span class="token" style="color:#a9b7c6">=&gt;</span> <span class="token" style="color:#9876aa">REGEX</span><span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#ffc66d">test</span><span class="token" style="color:#a9b7c6">(</span>x<span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>

<span class="token" style="color:#808080">// BAAAAAD!</span>
<span class="token" style="color:#cc7832">function</span><span class="token" style="color:#a9b7c6">(</span>array<span class="token" style="color:#a9b7c6">)</span> <span class="token" style="color:#a9b7c6">{</span>
  array<span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#ffc66d">forEach</span><span class="token" style="color:#a9b7c6">(</span>subarray <span class="token" style="color:#a9b7c6">=&gt;</span> <span class="token" style="color:#a9b7c6">{</span>

    <span class="token" style="color:#808080">// You just created one function per subarray!</span>
    subarray<span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#ffc66d">forEach</span><span class="token" style="color:#a9b7c6">(</span>x <span class="token" style="color:#a9b7c6">=&gt;</span> console<span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#ffc66d">log</span><span class="token" style="color:#a9b7c6">(</span>x<span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>
  <span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>
<span class="token" style="color:#a9b7c6">}</span>
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div class="WideLayout__Root-sc-16prk5t-0 ihLfci"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->Mixing types is bad</h3><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#808080">// Why do you do that?</span>
<span class="token" style="color:#808080">// If you are this kind of person, can we meet?</span>
<span class="token" style="color:#808080">// I really want to understand.</span>
<span class="token" style="color:#cc7832">const</span> array <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#a9b7c6">[</span><span class="token" style="color:#6897bb">1</span><span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">&#x27;two&#x27;</span><span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#6a8759">&#x27;3&#x27;</span><span class="token" style="color:#a9b7c6">,</span> <span class="token" style="background:#364135">/four/</span><span class="token" style="color:#a9b7c6">,</span> <span class="token" style="color:#a9b7c6">{</span>five<span class="token" style="color:#a9b7c6">:</span> <span class="token" style="color:#cc7832">new</span> <span class="token,class-name">Date</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">}</span><span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">;</span>
</code></pre></div></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->The poor man&#x27;s malloc</h3><ul class="sc-iAyFgw iLvMQI" font-size="2"><li class="sc-eHgmQL gmKbQu">Byte arrays are fan-ta-stic.</li><li class="sc-eHgmQL gmKbQu">Byte arrays are light.</li><li class="sc-eHgmQL gmKbQu">You can simulate typed memory allocation: <code class="sc-brqgnP gsyCmg" color="code">Uint8Array</code>, <code class="sc-brqgnP gsyCmg" color="code">Float32Array</code> etc.</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->Implement your own pointer system!</h3><p class="sc-kkGfuU kPOGYN" font-size="2">And have your very own &quot;C in JavaScript&quot;™.</p></div></div><div class="sc-htoDjs zIEGn"><div class="WideLayout__Root-sc-16prk5t-0 ihLfci"><div><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">A linked list (with pointers):
------------------------------
head -&gt; (a) -&gt; (b) -&gt; (c) -&gt; ø
</code></pre><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#808080">// Using object references as pointers</span>
<span class="token" style="color:#cc7832">function</span> <span class="token" style="color:#ffc66d">LinkedListNode</span><span class="token" style="color:#a9b7c6">(</span>value<span class="token" style="color:#a9b7c6">)</span> <span class="token" style="color:#a9b7c6">{</span>
  <span class="token" style="color:#cc7832">this</span><span class="token" style="color:#a9b7c6">.</span>next <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#cc7832">null</span><span class="token" style="color:#a9b7c6">;</span>
  <span class="token" style="color:#cc7832">this</span><span class="token" style="color:#a9b7c6">.</span>value <span class="token" style="color:#a9b7c6">=</span> value<span class="token" style="color:#a9b7c6">;</span>
<span class="token" style="color:#a9b7c6">}</span>
<span class="token" style="color:#808080">// Changing a pointer</span>
node<span class="token" style="color:#a9b7c6">.</span>next <span class="token" style="color:#a9b7c6">=</span> otherNode<span class="token" style="color:#a9b7c6">;</span>
</code></pre></div></div></div><div class="sc-htoDjs zIEGn"><div class="WideLayout__Root-sc-16prk5t-0 ihLfci"><div><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">A linked list (rolling our own pointers):
-----------------------------------------
head     = 0
values   = [a, b, c]
next     = [1, 2, 0]
</code></pre><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#808080">// Using byte arrays (capacity is fixed)</span>
<span class="token" style="color:#cc7832">function</span> <span class="token" style="color:#ffc66d">LinkedList</span><span class="token" style="color:#a9b7c6">(</span>capacity<span class="token" style="color:#a9b7c6">)</span> <span class="token" style="color:#a9b7c6">{</span>
  <span class="token" style="color:#cc7832">this</span><span class="token" style="color:#a9b7c6">.</span>head <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#6897bb">0</span><span class="token" style="color:#a9b7c6">;</span>
  <span class="token" style="color:#cc7832">this</span><span class="token" style="color:#a9b7c6">.</span>next <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#cc7832">new</span> <span class="token,class-name">Uint16Array</span><span class="token" style="color:#a9b7c6">(</span>capacity<span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>
  <span class="token" style="color:#cc7832">this</span><span class="token" style="color:#a9b7c6">.</span>values <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#cc7832">new</span> <span class="token,class-name">Array</span><span class="token" style="color:#a9b7c6">(</span>capacity<span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>
<span class="token" style="color:#a9b7c6">}</span>
<span class="token" style="color:#808080">// Changing a pointer;</span>
<span class="token" style="color:#cc7832">this</span><span class="token" style="color:#a9b7c6">.</span>next<span class="token" style="color:#a9b7c6">[</span>nodeIndex<span class="token" style="color:#a9b7c6">]</span> <span class="token" style="color:#a9b7c6">=</span> otherNodeIndex<span class="token" style="color:#a9b7c6">;</span>
</code></pre></div></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->Let&#x27;s build a most efficient LRU Cache!</h3><ul class="sc-iAyFgw iLvMQI" font-size="2"><li class="sc-eHgmQL gmKbQu">An object with maximum number of keys to save up some RAM.</li><li class="sc-eHgmQL gmKbQu">If we add a new key and we are full, we drop the <strong>L</strong>east <strong>R</strong>ecently <strong>U</strong>sed one.</li><li class="sc-eHgmQL gmKbQu">Useful to implement caches &amp; memoization.</li></ul></div></div><div class="sc-htoDjs zIEGn"><div class="WideLayout__Root-sc-16prk5t-0 ihLfci"><div><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">A ~doubly~ linked list:
-----------------------
head     = 0
tail     = 2
next     = [1, 2, 0]
prev     = [0, 1, 2]

Same as (with pointers):
------------------------
head -&gt; (a) &lt;-&gt; (b) &lt;-&gt; (c) &lt;- tail

A map to pointers &amp; values:
---------------------------
items  = {a: 0, b: 1, c: 2}
values = [a, b, c]
</code></pre></div></div></div><div class="sc-htoDjs zIEGn"><div><div class="sc-jAaTju UmMUS"><table class="sc-jDwBTQ hJnpUz"><thead><tr><th>name</th><th>set</th><th>get1</th><th>update</th><th>get2</th><th>evict</th></tr></thead><tbody><tr><td><a class="sc-kEYyzF RNNXF" href="https://www.npmjs.com/package/mnemonist" color="link">mnemonist-object</a></td><td>15314</td><td>69444</td><td>35026</td><td>68966</td><td>7949</td></tr><tr><td><a class="sc-kEYyzF RNNXF" href="https://npmjs.com/package/tiny-lru" color="link">tiny-lru</a></td><td>6530</td><td>46296</td><td>37244</td><td>42017</td><td>5961</td></tr><tr><td><a class="sc-kEYyzF RNNXF" href="https://npmjs.com/package/lru-fast" color="link">lru-fast</a></td><td>5979</td><td>36832</td><td>32626</td><td>40900</td><td>5929</td></tr><tr><td><a class="sc-kEYyzF RNNXF" href="https://www.npmjs.com/package/mnemonist" color="link">mnemonist-map</a></td><td>6272</td><td>15785</td><td>10923</td><td>16077</td><td>3738</td></tr><tr><td><a class="sc-kEYyzF RNNXF" href="https://www.npmjs.com/package/lru" color="link">lru</a></td><td>3927</td><td>5454</td><td>5001</td><td>5366</td><td>2827</td></tr><tr><td><a class="sc-kEYyzF RNNXF" href="https://npmjs.com/package/simple-lru-cache" color="link">simple-lru-cache</a></td><td>3393</td><td>3855</td><td>3701</td><td>3899</td><td>2496</td></tr><tr><td><a class="sc-kEYyzF RNNXF" href="https://npmjs.com/package/hyperlru-object" color="link">hyperlru-object</a></td><td>3515</td><td>3953</td><td>4044</td><td>4102</td><td>2495</td></tr><tr><td><a class="sc-kEYyzF RNNXF" href="https://www.npmjs.com/package/js-lru" color="link">js-lru</a></td><td>3813</td><td>10010</td><td>9246</td><td>10309</td><td>1843</td></tr></tbody></table></div><small>Bench <a href="https://github.com/dominictarr/bench-lru">here</a> - I masked libraries which are not LRU per se.</small></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->Function calls are costly</h3><p class="sc-kkGfuU kPOGYN" font-size="2">Everything is costly. Life is harsh.</p><p class="sc-kkGfuU kPOGYN" font-size="2">This means that rolling your own stack will always beat recursion.</p></div></div><div class="sc-htoDjs zIEGn"><div class="WideLayout__Root-sc-16prk5t-0 ihLfci"><div><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#808080">// Recursive version - &quot;easy&quot;</span>
<span class="token" style="color:#cc7832">function</span> <span class="token" style="color:#ffc66d">recurse</span><span class="token" style="color:#a9b7c6">(</span>node<span class="token" style="color:#a9b7c6">,</span> key<span class="token" style="color:#a9b7c6">)</span> <span class="token" style="color:#a9b7c6">{</span>
  <span class="token" style="color:#cc7832">if</span> <span class="token" style="color:#a9b7c6">(</span>key <span class="token" style="color:#a9b7c6">&lt;</span> node<span class="token" style="color:#a9b7c6">.</span>value<span class="token" style="color:#a9b7c6">)</span> <span class="token" style="color:#a9b7c6">{</span>
    <span class="token" style="color:#cc7832">if</span> <span class="token" style="color:#a9b7c6">(</span>node<span class="token" style="color:#a9b7c6">.</span>left<span class="token" style="color:#a9b7c6">)</span>
      <span class="token" style="color:#cc7832">return</span> <span class="token" style="color:#ffc66d">recurse</span><span class="token" style="color:#a9b7c6">(</span>node<span class="token" style="color:#a9b7c6">.</span>left<span class="token" style="color:#a9b7c6">,</span> key<span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>

    <span class="token" style="color:#cc7832">return</span> <span class="token" style="color:#cc7832">false</span><span class="token" style="color:#a9b7c6">;</span>
  <span class="token" style="color:#a9b7c6">}</span>
  <span class="token" style="color:#cc7832">else</span> <span class="token" style="color:#cc7832">if</span> <span class="token" style="color:#a9b7c6">(</span>key <span class="token" style="color:#a9b7c6">&gt;</span> node<span class="token" style="color:#a9b7c6">.</span>value<span class="token" style="color:#a9b7c6">)</span> <span class="token" style="color:#a9b7c6">{</span>
    <span class="token" style="color:#cc7832">if</span> <span class="token" style="color:#a9b7c6">(</span>node<span class="token" style="color:#a9b7c6">.</span>right<span class="token" style="color:#a9b7c6">)</span>
      <span class="token" style="color:#cc7832">return</span> <span class="token" style="color:#ffc66d">recurse</span><span class="token" style="color:#a9b7c6">(</span>node<span class="token" style="color:#a9b7c6">.</span>right<span class="token" style="color:#a9b7c6">,</span> key<span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>

    <span class="token" style="color:#cc7832">return</span> <span class="token" style="color:#cc7832">false</span><span class="token" style="color:#a9b7c6">;</span>
  <span class="token" style="color:#a9b7c6">}</span>

  <span class="token" style="color:#cc7832">return</span> <span class="token" style="color:#cc7832">true</span><span class="token" style="color:#a9b7c6">;</span>
<span class="token" style="color:#a9b7c6">}</span>
</code></pre></div></div></div><div class="sc-htoDjs zIEGn"><div class="WideLayout__OtherRoot-sc-16prk5t-1 fQmsFW"><div><pre style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;background:#2b2b2b"><code style="color:#a9b7c6;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#808080">// Iterative version - more alien but faster, mileage may vary</span>
<span class="token" style="color:#cc7832">function</span> <span class="token" style="color:#ffc66d">iterative</span><span class="token" style="color:#a9b7c6">(</span>root<span class="token" style="color:#a9b7c6">,</span> key<span class="token" style="color:#a9b7c6">)</span> <span class="token" style="color:#a9b7c6">{</span>
  <span class="token" style="color:#cc7832">const</span> stack <span class="token" style="color:#a9b7c6">=</span> <span class="token" style="color:#a9b7c6">[</span>root<span class="token" style="color:#a9b7c6">]</span><span class="token" style="color:#a9b7c6">;</span>
  <span class="token" style="color:#cc7832">while</span> <span class="token" style="color:#a9b7c6">(</span>stack<span class="token" style="color:#a9b7c6">.</span>length<span class="token" style="color:#a9b7c6">)</span> <span class="token" style="color:#a9b7c6">{</span>
    <span class="token" style="color:#cc7832">const</span> node <span class="token" style="color:#a9b7c6">=</span> stack<span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#ffc66d">pop</span><span class="token" style="color:#a9b7c6">(</span><span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>
    <span class="token" style="color:#cc7832">if</span> <span class="token" style="color:#a9b7c6">(</span>key <span class="token" style="color:#a9b7c6">&lt;</span> node<span class="token" style="color:#a9b7c6">.</span>value<span class="token" style="color:#a9b7c6">)</span> <span class="token" style="color:#a9b7c6">{</span>
      <span class="token" style="color:#cc7832">if</span> <span class="token" style="color:#a9b7c6">(</span>node<span class="token" style="color:#a9b7c6">.</span>left<span class="token" style="color:#a9b7c6">)</span>
        stack<span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#ffc66d">push</span><span class="token" style="color:#a9b7c6">(</span>node<span class="token" style="color:#a9b7c6">.</span>left<span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>
      <span class="token" style="color:#cc7832">else</span>
        <span class="token" style="color:#cc7832">break</span><span class="token" style="color:#a9b7c6">;</span>
    <span class="token" style="color:#a9b7c6">}</span>
    <span class="token" style="color:#cc7832">else</span> <span class="token" style="color:#cc7832">if</span> <span class="token" style="color:#a9b7c6">(</span>key <span class="token" style="color:#a9b7c6">&gt;</span> node<span class="token" style="color:#a9b7c6">.</span>value<span class="token" style="color:#a9b7c6">)</span> <span class="token" style="color:#a9b7c6">{</span>
      <span class="token" style="color:#cc7832">if</span> <span class="token" style="color:#a9b7c6">(</span>node<span class="token" style="color:#a9b7c6">.</span>right<span class="token" style="color:#a9b7c6">)</span>
        stack<span class="token" style="color:#a9b7c6">.</span><span class="token" style="color:#ffc66d">push</span><span class="token" style="color:#a9b7c6">(</span>node<span class="token" style="color:#a9b7c6">.</span>right<span class="token" style="color:#a9b7c6">)</span><span class="token" style="color:#a9b7c6">;</span>
      <span class="token" style="color:#cc7832">else</span>
        <span class="token" style="color:#cc7832">break</span><span class="token" style="color:#a9b7c6">;</span>
    <span class="token" style="color:#a9b7c6">}</span>
    <span class="token" style="color:#cc7832">return</span> <span class="token" style="color:#cc7832">true</span><span class="token" style="color:#a9b7c6">;</span>
  <span class="token" style="color:#a9b7c6">}</span>
  <span class="token" style="color:#cc7832">return</span> <span class="token" style="color:#cc7832">false</span><span class="token" style="color:#a9b7c6">;</span>
<span class="token" style="color:#a9b7c6">}</span>
</code></pre></div></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->What about wasm etc. ?</h3><p class="sc-kkGfuU kPOGYN" font-size="2">Lots of shiny options:</p><ol class="sc-hSdWYo fJODMz" font-size="2"><li class="sc-eHgmQL gmKbQu">asm.js</li><li class="sc-eHgmQL gmKbQu">WebAssembly</li><li class="sc-eHgmQL gmKbQu">Native code binding in Node.js</li></ol></div></div><div class="sc-htoDjs zIEGn"><div><p class="sc-kkGfuU kPOGYN" font-size="2">Communication between those and JavaScript has a cost that negates the benefit.</p><p class="sc-kkGfuU kPOGYN" font-size="2">This is only viable if you have long running code or don&#x27;t need the bridge between the layer and JavaScript.</p></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-bRBYWo ccSRck sc-Rmtcm bQMXUX" font-size="3" color="heading"><span class="affix">•</span> <!-- -->Parting words</h2></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->Yes, optimizing JavaScript is hard.</h3></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->But it does not mean we cannot do it.</h3></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->Most tips are applicable to every high-level languages.</h3></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->But JavaScript has its very own kinks</h3><p class="sc-kkGfuU kPOGYN" font-size="2">The <code class="sc-brqgnP gsyCmg" color="code">ByteArray</code> tips absolutely don&#x27;t work in python.</p><p class="sc-kkGfuU kPOGYN" font-size="2">It&#x27;s even slower if you use <code class="sc-brqgnP gsyCmg" color="code">numpy</code> arrays. (you need to go full native).</p></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->The gist</h3><p class="sc-kkGfuU kPOGYN" font-size="2">To be efficient your code must be <strong>statically interpretable</strong>.</p><p class="sc-kkGfuU kPOGYN" font-size="2">If you do that:</p><ol class="sc-hSdWYo fJODMz" font-size="2"><li class="sc-eHgmQL gmKbQu">The engine will have <strong>no hard decisions</strong> to make</li><li class="sc-eHgmQL gmKbQu">And will safely choose the most aggressive optimization paths</li></ol></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->Rephrased</h3><p class="sc-kkGfuU kPOGYN" font-size="2">Optimizing JavaScript = squinting a little and <strong>pretending</strong> really hard that:</p><ol class="sc-hSdWYo fJODMz" font-size="2"><li class="sc-eHgmQL gmKbQu">The language has static typing.</li><li class="sc-eHgmQL gmKbQu">That the language is low-level.</li></ol></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-jhAzac hmXDXQ sc-hzDkRC gaOIFD" font-size="2" color="heading"><span class="affix">•</span> <!-- -->Associative arrays are the next frontier</h3><p class="sc-kkGfuU kPOGYN" font-size="2">For now, there is no way to beat JavaScript&#x27;s objects and maps when doing key-value association.</p><p class="sc-kkGfuU kPOGYN" font-size="2"><em>Yet...</em></p></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-bRBYWo ccSRck sc-Rmtcm bQMXUX" font-size="3" color="heading"><span class="affix">•</span> <!-- -->So implement away!</h2></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-bRBYWo ccSRck sc-Rmtcm bQMXUX" font-size="3" color="heading"><span class="affix">•</span> <!-- -->References</h2><p class="sc-kkGfuU kPOGYN" font-size="2">Examples were taken from the following libraries:</p><ul class="sc-iAyFgw iLvMQI" font-size="2"><li class="sc-eHgmQL gmKbQu"><a class="sc-kEYyzF RNNXF" href="https://yomguithereal.github.io/mnemonist" color="link">mnemonist</a>: <small><em>yomguithereal.github.io/mnemonist</em></small></li><li class="sc-eHgmQL gmKbQu"><a class="sc-kEYyzF RNNXF" href="https://graphology.github.io" color="link">graphology</a>: <small><em>graphology.github.io</em></small></li><li class="sc-eHgmQL gmKbQu"><a class="sc-kEYyzF RNNXF" href="http://sigmajs.org" color="link">sigma.js</a>: <small><em>sigmajs.org</em></small></li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h1 class="sc-cSHVUG CAuLq sc-jzJRlG hLseSp" font-size="4" color="heading">Thanks!</h1></div></div></div></div></div></div></div>
<script src="main.js"></script>
</body>
</html>
